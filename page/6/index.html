<!DOCTYPE html>
<html lang="zh-cn">
    
  <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.62.2" />

    

<title>Feisky</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Notes about anything"/>

<meta property="og:title" content="" />
<meta property="og:description" content="Notes about anything" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://feisky.xyz/" />
<meta property="og:updated_time" content="2018-10-14T22:08:45+08:00" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.92c66d107d7b219f0792cfd67223179af884b03f386ac46894f9f735932bbca3.css" integrity="sha256-ksZtEH17IZ8Hks/WciMXmviEsD84asRolPn3NZMrvKM=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/tocbot.126e7d75240acc946d34d6ccb2982ed4c394a5fe34e73e1a2119ca951bcf119d.css" integrity="sha256-Em59dSQKzJRtNNbMspgu1MOUpf405z4aIRnKlRvPEZ0=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="alternate" type="application/rss+xml" href="https://feisky.xyz/index.xml" title="Feisky" />

    

</head>


    <body class="theme-base-0d ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://feisky.xyz/">Feisky</a>
      </span>
      
      
      <p class="site__description">
         Notes about anything 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Feisky</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="https://kubernetes.feisky.xyz">
						<span>Kubernetes指南</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://time.geekbang.org/column/intro/100020901">
						<span>Linux性能优化实战</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="https://sdn.feisky.xyz">
						<span>SDN网络</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/machine-learning/">
						<span>机器学习</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>关于我</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/feisky" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/feiskyer" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 feiskyer
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
  <div class="post-list">
    
    
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/2017-03-15-kubernetes-ha/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: post title: Kubernetes HA date: 2017-03-15 18:12:47 tags: [kubernetes] Kubernetes从1.5开始，通过kops或者kube-up.sh部署的集群会自动部署一个高可用的系统，包括
 etcd集群模式 apiserver负载均衡 controller manager、scheduler和cluster autoscaler自动选主（有且仅有一个运行实例）  如下图所示
etcd集群 从https://discovery.etcd.io/new?size=3获取token后，把https://kubernetes.io/docs/admin/high-availability/etcd.yaml放到每台机器的/etc/kubernetes/manifests/etcd.yaml，并替换掉${DISCOVERY_TOKEN}, ${NODE_NAME}和${NODE_IP}，既可以由kubelet来启动一个etcd集群。
对于运行在kubelet外部的etcd，可以参考etcd clustering guide来手动配置集群模式。
apiserver 把https://kubernetes.io/docs/admin/high-availability/kube-apiserver.yaml放到每台Master节点的/etc/kubernetes/manifests/，并把相关的配置放到/srv/kubernetes/，即可由kubelet自动创建并启动apiserver:
 basic_auth.csv - basic auth user and password ca.crt - Certificate Authority cert known_tokens.csv - tokens that entities (e.g. the kubelet) can use to talk to the apiserver kubecfg.crt - Client certificate, public key kubecfg.key - Client certificate, private key server.cert - Server certificate, public key server.
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/2017-03-15-kubernetes-ha/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/2017-04-19-linuxkit/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: post title: LinuxKit date: 2017-04-19 11:09:53 tags: [docker] LinuxKit是Docker最新发布的一个用于为容器构建安全、便携、可移植操作系统的工具包。它根据用户编写的yaml（指定kernel和基于docker image的一些列服务）自动构建一个常见虚拟化平台或云平台的虚拟机镜像，并自动运行起来。主要特性包括
 增强安全性  系统安全，基于MirageOS unikernel 紧跟最新kernel并精简不必要的模块 Immutable，只读根文件系统，根文件系统只能在构建的时候生成 社区合作，比如Kernel Self Protection Project (KSPP)、Wireguard、Landlock、Mirage、oKernel、Clear Containers等   易用、可扩展  所有服务均可定制，且用户服务和系统服务都是基于docker image 构建过程基于docker 基于Infrakit方便部署生成的镜像    安装 git clone https://github.com/linuxkit/linuxkit $GOPATH/src/github.com/linuxkit/linuxkit make &amp;&amp; make install 原理 编写yaml LinuxKit需要编写一个yaml文件，来配置所需要的服务。可选的配置包括
 kernel：指定内核镜像，镜像里面需要包含bzImage和kernel.tar init：指定根系统的docker镜像（ base init process Docker images），比如init、runc、containerd等。在运行时，这些都是只读的 onboot：启动过程中执行的系统服务，按顺序逐个运行 services：基于docker镜像的系统服务，这些服务在build的时候会由docker将其转换为OCI格式，以便后续runc来启动 files：指定额外的文件 outputs：构建完成后的输出  比如一个简单的nginx服务为
kernel: image: &#34;mobylinux/kernel:4.9.x&#34; cmdline: &#34;console=ttyS0 console=tty0 page_poison=1&#34; init: - linuxkit/init:42fe8cb1508b3afed39eb89821906e3cc7a70551 - mobylinux/runc:b0fb122e10dbb7e4e45115177a61a3f8d68c19a9 - linuxkit/containerd:60e2486a74c665ba4df57e561729aec20758daed - mobylinux/ca-certificates:eabc5a6e59f05aa91529d80e9a595b85b046f935 onboot: - name: sysctl image: &#34;mobylinux/sysctl:2cf2f9d5b4d314ba1bfc22b2fe931924af666d8c&#34; net: host pid: host ipc: host capabilities: - CAP_SYS_ADMIN readonly: true - name: binfmt image: &#34;linuxkit/binfmt:8881283ac627be1542811bd25c85e7782aebc692&#34; binds: - /proc/sys/fs/binfmt_misc:/binfmt_misc readonly: true - name: dhcpcd image: &#34;linuxkit/dhcpcd:48e249ebef6a521eed886b3bce032db69fbb4afa&#34; binds: - /var:/var - /tmp/etc:/etc capabilities: - CAP_NET_ADMIN - CAP_NET_BIND_SERVICE - CAP_NET_RAW net: host command: [&#34;/sbin/dhcpcd&#34;, &#34;--nobackground&#34;, &#34;-f&#34;, &#34;/dhcpcd.
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/2017-04-19-linuxkit/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/alpine-linux/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Alpine Linux&rdquo; date: &ldquo;2016-03-26 14:27&rdquo; Alpine Linux
随着Alpine Linux被越来越多的官方镜像使用，我们有必要了解一下Alpine Linux到底是个什么鬼。
Alpine Linux 是一个面向安全应用的轻量级 Linux 发行版。它采用了musl libc和busybox以减小系统的体积和运行时资源消耗，同时还提供了自己的包管理工具apk。Alpine Linux的内核都打了grsecurity/PaX补丁，并且所有的程序都编译为Position Independent Executables (PIE) 以增强系统的安全性。
Alpine Linux小试 我们可以通过虚拟机来体验一下完整的Alpine Linux。从alpinelinux.org下载iso（当前是v3.3.3版本，大小为78MB），然后就可以通过Virtual Box或者VMWare创建虚拟机了。默认情况下，启动的虚拟机是diskless模式，重启虚拟机会丢掉所有的变更。因而，建议通过setup-alpine来修改安装模式，同时也对系统进行一些配置的初始化。
Alpine社区提供了Docker包，可以方便的安装Docker：
echo “http://nl.alpinelinux.org/alpine/v3.3/community” &gt;&gt; /etc/apk/repositories apk update apk add docker rc-update add docker boot service docker start Alpine Docker镜像 Docker官方还维护了一个Alpine Linux镜像，大小只有4.7MB，比起大家常用的Ubuntu要小的多。现在有很多镜像都已经用这个镜像来代替了以前的Ubuntu/Debian了，比如常用的haproxy、nginx等。
Alpine Linux的官方网站为[http://alpinelinux.org]，从[http://wiki.alpinelinux.org]可以找到更多的使用指南。
        
        </span>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/docker-datacenter/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Docker Datacenter&rdquo; date: &ldquo;2016-02-26 17:38&rdquo; category: docker tags: [docker, cluster] Docker annonced Docker Datacenter (DDC) at Februrary 23. It is an integrated, end-to-end platform for agile application development and management from the datacenter to the cloud.
With Docker Datacenter, organizations are empowered to deploy a Containers as a Services (CaaS) on-premises or in your virtual private cloud. A CaaS provides an IT managed and secured application environment of content and infrastructure where developers can build and deploy applications in a self service manner.
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/docker-datacenter/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/googles-transition-from-single-datacenter-to-failover-to-a-native-multihomed-architecture/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Google's Transition From Single Datacenter, To Failover, To A Native Multihomed Architecture&rdquo; date: &ldquo;2016-02-24 10:33&rdquo; category: cluster tags: [highscalability, google] The main idea of the paper is that the typical failover architecture used when moving from a single datacenter to multiple datacenters doesn’t work well in practice. What does work, where work means using fewer resources while providing high availability and consistency, is a natively multihomed architecture:
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/googles-transition-from-single-datacenter-to-failover-to-a-native-multihomed-architecture/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/hello-world-to-docker-mac/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Hello world to Docker Mac&rdquo; date: &ldquo;2016-04-15 16:34&rdquo; 终于等到了Docker for Mac。如之前期待的，体验真的很棒：
 安装简单了，标准的Mac Application  VPN无障碍 原生的（osxfs）文件系统共享（其实还支持9p方式） Docker Application管理 xhyve VM，更改配置后会自动重启 速度快，在使用体验上跟在Linux上面已经差别不大 可以与docker toolbox共存：Docker for Mac也会像Linux上面一样监听一个/var/run/docker.sock，这样客户端默认情况下就会走它的API；但也可以通过环境变量告诉docker CLI调用其他Docker Daemon的API（比如docker-machine管理的vm等）  跑一个nginx试试：
➜ ~ docker version Client: Version: 1.11.0 API version: 1.23 Go version: go1.5.4 Git commit: 4dc5990 Built: Wed Apr 13 19:36:04 2016 OS/Arch: darwin/amd64 Server: Version: 1.11.0 API version: 1.23 Go version: go1.5.4 Git commit: a5315b8 Built: Thu Apr 14 10:19:52 2016 OS/Arch: linux/amd64 ➜ ~ ➜ ~ ls /var/run/docker.
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/hello-world-to-docker-mac/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/kubernetes-drain/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Kubernetes drain&rdquo; date: &ldquo;2016-02-17 18:57&rdquo; Kubernetes v1.2以前，如果想要对某个NODE（也就是Kubelet和Docker所在的机器）进行维护（比如升级Docker或者内核等）又不想影响运行中的Pod的话，需要手动做很多的步骤：
 首先patch NODE，将其改为不可调度状态： kubectl patch nodes $NODENAME -p '{&quot;spec&quot;: {&quot;unschedulable&quot;: true}}' 然后逐一删掉该NODE上的Pod，由Replication Ctroller自动到其它NODE上创建新的Pod 维护结束后再重新patch NODE，将其改成正常状态  在即将发布的v1.2中，kubectl中增加了drain和uncordon命令，使得这个过程更为简单易用。
kubectl drain kubectl drain的功能是将NODE改为维护模式，使用方法为
kubectl drain NODE [Options] 其中，可选的Options为：
--force[=false]: Continue even if there are pods not managed by a ReplicationController, Job, or DaemonSet. --grace-period=-1: Period of time in seconds given to each pod to terminate gracefully. If negative, the default value specified in the pod will be used.
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/kubernetes-drain/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/kubernetes-network-policy/" ></a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        layout: &ldquo;post&rdquo; title: &ldquo;Kubernetes network policy&rdquo; date: &ldquo;2016-02-17 18:53&rdquo; Kubernetes network policy
Kubernetes社区（确切的说是Kubernetes Network SIG [1]）正在讨论Network Policy Proposal，以实现SDN、网络隔离、IP Overlapping等[2]复杂的网络需求。
目前，正在讨论的Proposals有多个：
 Consolidated Casey/RH Proposal https://docs.google.com/document/d/1blfqiH4L_fpn33ZrnQ11v7LcYP0lmpiJ_RaapAPBbNU/edit Casey Davenport https://docs.google.com/document/d/16fg7Dc7K5m4bM2vGwyvkhPG_lcBKeOjaUSYBMwZlR_o/edit?usp=sharing Vipin Jain https://docs.google.com/a/insiemenetworks.com/document/d/1KKMOJSXKKQOzlblAzwYV72KGUlAuAaUuFqCWO8h4gd0/edit?usp=sharing Tim Hockin https://docs.google.com/document/d/1bXUO-Lp6smmLm7SMGwrwuvK23wgsaWvx6Mkt-Y0AtZ0/edit#  这几个Proposal都大同小异，主要的思想都是一致的：
 默认情况下网络模型跟现在保持一致，只有定义了Network Policy并且实现了相应的Network Plugin的时候，这个Proposal才有意义 Network Policy: 管理网络连通性策略，这些策略与具体的网络实现（如libnetwork等）无关 Network Policy通过Label作用到Pod/Service上 需要Network Plugin配合实现Network Policy  下面就以Consolidated Casey/RH Proposal为例看看具体的Proposal都有啥。
设计目标  不影响现有的网络架构，即未定义Network Policy时，保持Kubernetes现有的网络架构 基于ThirdPartyResource实现NetworkPolicy资源的管理  Namespaces Namespace spec中增加isolation，默认关闭。当isolation打开后
 所有访问该Namespace内部Pods的请求都被拒绝(也包括该Namespace内部的Pods访问内部的其他Pods） 例外：为了不影响Health Check，从Node上访问Pods均允许  apiVersion: v1 kind: Namespace metadata: name: IsolatedApp spec: isolation: [ yes | no ] NetworkPolicy Objects 当Namespace的isolation打开的时候，需要NetworkPolicy来控制访问策略。访问策略的规则为：
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/kubernetes-network-policy/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/2015-02-06-apachemesosgooglekubernetes-/" >Apache的Mesos和Google的Kubernetes 有什么区别</a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        Kubernetes是一个开源项目，它把谷歌的集群管理工具引入到虚拟机和裸机场景中。它可以完美运行在现代的操作系统环境（比如CoreOS和R
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/2015-02-06-apachemesosgooglekubernetes-/">➦</a>
        
        </div>
        
     
      
        
      
      <div class="post-list__item">
        <span class="item__title--big">
          <a href="/posts/2015-03-20-awesome-quick-start/" >awesome quick start</a>
        </span>
        <span class="item__date">
          Jan 01, 0001
        </span>
        <span >
        
        awesome是Linux平台出色的窗口管理器，具有速度快、界面简捷等优点。其安装也比较简单： sudo apt-get install -y awesome awesome-extra gnome-settings-daemon nautilus sudo apt-get install -y --no-install-recommends gnome-session mkdir -p ~/.config/awesome 常用快捷键整
        
        </span>
        
          ... <a class="read-more-symbol" href="/posts/2015-03-20-awesome-quick-start/">➦</a>
        
        </div>
        
     
  </div>
  

<ul class="pagination">
    
    <li class="page-item">
        <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/page/5/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/5/">5</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/page/6/">6</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/7/">7</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/11/">11</a></li>
    
    
    <li class="page-item">
    <a href="/page/7/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/page/11/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


        </div>
        
  
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-69699206-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  <script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    </body>
</html>
