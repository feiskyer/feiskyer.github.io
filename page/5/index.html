<!doctype html><html lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.80.0"><title>Feisky</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Feisky"><meta name=twitter:description content><meta property="og:title" content="Feisky"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://feisky.xyz/"><meta property="og:updated_time" content="2021-01-29T00:00:00+00:00"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css><link rel=stylesheet href=/scss/hyde-hyde.71157e768c4e111a23c3531b95e0cbb59bbef3c9e6901d36247cb53d6b6be258.css integrity="sha256-cRV+doxOERojw1MbleDLtZu+88nmkB02JHy1PWtr4lg="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><link rel=stylesheet href=/scss/tocbot.5ef07cebc3c477b54270456f149ee02922479bb7555fd344b2c69f953b0e7e5e.css integrity="sha256-XvB868PEd7VCcEVvFJ7gKSJHm7dVX9NEssaflTsOfl4="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link rel=alternate type=application/rss+xml href=https://feisky.xyz/index.xml title=Feisky></head><body class=theme-base-0d><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://feisky.xyz/>Feisky</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/f86d2faa0f91793a2163d226d82a7620?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description></p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Feisky</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=https://time.geekbang.org/column/intro/100020901><span>Linux性能优化实战</span></a></li><li><a href=https://kubernetes.feisky.xyz><span>Kubernetes指南</span></a></li><li><a href=https://sdn.feisky.xyz><span>SDN网络指南</span></a></li><li><a href=/assets/mp.png><span>微信公众号</span></a></li><li><a href=https://zhuanlan.zhihu.com/kubernetes><span>知乎专栏</span></a></li><li><a href=/about/><span>关于我</span></a></li></ul></div><section class=social><a href=https://twitter.com/feisky rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://github.com/feiskyer rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2021 feiskyer
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div><div class=builtwith>Built with <a href=https://gohugo.io>Hugo</a> ❤️ <a href=https://github.com/htr3n/hyde-hyde>hyde-hyde</a>.</div></div></div><div class="content container"><div class=post-list><div class=post-list__item><span class=item__title--big><a href=/posts/2016-05-11-how-docker-1-11-share-network-accross-containers/>How docker 1.11 share network accross containers</a></span>
<span class=item__date>May 11, 2016</span>
<span>Docker 1.11 has moved to runc with containerd, I am interested in how it processing shared netns accross containers.
For example, I have already running a container 75599a6f387b7842c6da57efd38f9742b2ca621782f891402f83852c66dbd706. A new container within same netns can be created with cmd:
docker run -itd --net=container:75599a6f387b alpine sh This will generate a runc config.json as follows:
{ "ociVersion": "0.6.0-dev", "platform": { "os": "linux", "arch": "amd64" }, "process": { "terminal": true, "user": { "additionalGids": [ 0, 1, 2, 3, 4, 6, 10, 11, 20, 26, 27 ] }, "args": [ "sh" ], "env": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "HOSTNAME=75599a6f387b", "TERM=xterm" ], "cwd": "/", "capabilities": [ "CAP_CHOWN", "CAP_DAC_OVERRIDE", "CAP_FSETID", "CAP_FOWNER", "CAP_MKNOD", "CAP_NET_RAW", "CAP_SETGID", "CAP_SETUID", "CAP_SETFCAP", "CAP_SETPCAP", "CAP_NET_BIND_SERVICE", "CAP_SYS_CHROOT", "CAP_KILL", "CAP_AUDIT_WRITE" ] }, "root": { "path": "/var/lib/docker/devicemapper/mnt/d33c7932917e64bde482b437fc3ccaad9a00a04e0cf49e39f9d3be5d71991db6/rootfs", "readonly": false }, "hostname": "75599a6f387b", "mounts": [ { "destination": "/proc", "type": "proc", "source": "proc", "options": [ "nosuid", "noexec", "nodev" ] }, { "destination": "/dev", "type": "tmpfs", "source": "tmpfs", "options": [ "nosuid", "strictatime", "mode=755" ] }, { "destination": "/dev/pts", "type": "devpts", "source": "devpts", "options": [ "nosuid", "noexec", "newinstance", "ptmxmode=0666", "mode=0620", "gid=5" ] }, { "destination": "/sys", "type": "sysfs", "source": "sysfs", "options": [ "nosuid", "noexec", "nodev", "ro" ] }, { "destination": "/sys/fs/cgroup", "type": "cgroup", "source": "cgroup", "options": [ "ro", "nosuid", "noexec", "nodev" ] }, { "destination": "/dev/mqueue", "type": "mqueue", "source": "mqueue", "options": [ "nosuid", "noexec", "nodev" ] }, { "destination": "/etc/resolv.</span>
... <a class=read-more-symbol href=/posts/2016-05-11-how-docker-1-11-share-network-accross-containers/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-05-06-go-performance-optimize/>Go performance optimize</a></span>
<span class=item__date>May 06, 2016</span>
<span>**Go性能优化技巧(By 雨痕) 字符串（string）作为一种不可变类型，在与字节数组（slice, byte）转换时需付出 “沉重” 代价，根本</span>
... <a class=read-more-symbol href=/posts/2016-05-06-go-performance-optimize/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-05-05-the-rise-of-cloud-computing-systems-jeff-dean/>The Rise of Cloud Computing Systems - Jeff Dean</a></span>
<span class=item__date>May 05, 2016</span>
<span>{% pdf http://feiskyer.github.io/assets/ccs.pdf %}</span></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-29-reading-notes-of-week-17/>Reading notes of week 17</a></span>
<span class=item__date>Apr 29, 2016</span>
<span>SIG-Networking: Kubernetes Network Policy APIs Coming in 1.3 One problem many users have is that the open access network policy of Kubernetes is not suitable for applications that need more precise control over the traffic that accesses a pod or service. Today, this could be a multi-tier application where traffic is only allowed from a tier’s neighbor. But as new Cloud Native applications are built</span>
... <a class=read-more-symbol href=/posts/2016-04-29-reading-notes-of-week-17/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-28-runc/>runc and runV</a></span>
<span class=item__date>Apr 28, 2016</span>
<span>runc is a CLI tool for spawning and running containers according to the OCI specification, while runV is a hypervisor-based runtime for OCI. Both of them are recommanded (implementations](https://github.com/opencontainers/runtime-spec/blob/master/implementations.md) of OCI.
Playing with runc Install runc:
yum install -y libseccomp-devel mkdir -p $GOPATH/src/github.com/opencontainers cd $GOPATH/src/github.com/opencontainers git clone https://github.com/opencontainers/runc cd runc make sudo make install Run busybox:
$ docker pull busybox $ mkdir rootfs $ docker export $(docker create busybox) | tar -C rootfs -xvf - $ runc spec .</span>
... <a class=read-more-symbol href=/posts/2016-04-28-runc/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-28-docker-1-11-runtime/>Container runtime in Docker v1.11</a></span>
<span class=item__date>Apr 28, 2016</span>
<span>Docker v1.11正式集成了runc（终于支持OCI了），并将原来的一个二进制文件拆分为多个，同时还保持docker CLI和API不变： docker docker-containerd docker-containerd-shim docker-runc docker-containerd-ctr</span>
... <a class=read-more-symbol href=/posts/2016-04-28-docker-1-11-runtime/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-24-dpdk-introduction/>DPDK Introduction</a></span>
<span class=item__date>Apr 24, 2016</span>
<span>DPDK Introduction Intel DPDK全称Intel Data Plane Development Kit，是intel提供的数据平面开发工具集，为Intel architecture（IA）处理器架构下用户</span>
... <a class=read-more-symbol href=/posts/2016-04-24-dpdk-introduction/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-24-tips-for-cgo/>Tips for cgo</a></span>
<span class=item__date>Apr 24, 2016</span>
<span>cgo的一些tips 基本类型 The standard C numeric types are available under the names C.char, C.schar (signed char), C.uchar (unsigned char), C.short, C.ushort (unsigned short), C.int, C.uint (unsigned int), C.long, C.ulong (unsigned long), C.longlong (long long), C.ulonglong (unsigned long long), C.float, C.double, C.complexfloat (complex float), and C.complexdouble (complex double). The C type void* is represented by Go&rsquo;s unsafe.Pointer. The C</span>
... <a class=read-more-symbol href=/posts/2016-04-24-tips-for-cgo/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-04-19-cgo-in-go-1-6/>cgo in go 1.6</a></span>
<span class=item__date>Apr 19, 2016</span>
<span>The major change is the definition of rules for sharing Go pointers with C code, to ensure that such C code can coexist with Go&rsquo;s garbage collector. Briefly, Go and C may share memory allocated by Go when a pointer to that memory is passed to C as part of a cgo call, provided that the memory itself contains no pointers to Go-allocated memory, and provided that C does not retain the pointer after the call returns.</span>
... <a class=read-more-symbol href=/posts/2016-04-19-cgo-in-go-1-6/>➦</a></div><div class=post-list__item><span class=item__title--big><a href=/posts/2016-03-04-borg-omega-and-kubernetes-acm-queue/>Borg, Omega, and Kubernetes (ACM Queue)</a></span>
<span class=item__date>Mar 04, 2016</span>
<span>Brendan Burns, Brian Grant等在Borg, Omega, and Kubernetes - Lessons learned from three container-management systems over a decade分享了Google在容器管理的经验教训。 在谷歌的历史上，开发了三种容器管理</span>
... <a class=read-more-symbol href=/posts/2016-03-04-borg-omega-and-kubernetes-acm-queue/>➦</a></div></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/4/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class=page-item><a class=page-link href=/page/4/>4</a></li><li class="page-item active"><a class=page-link href=/page/5/>5</a></li><li class=page-item><a class=page-link href=/page/6/>6</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/13/>13</a></li><li class=page-item><a href=/page/6/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/13/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-69699206-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.12.1/js/all.js integrity=sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR crossorigin=anonymous></script></body></html>